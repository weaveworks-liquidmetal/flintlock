"use strict";(self.webpackChunkuserdocs=self.webpackChunkuserdocs||[]).push([[412],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=l(n),m=o,f=p["".concat(c,".").concat(m)]||p[m]||u[m]||a;return n?r.createElement(f,i(i({ref:t},d),{},{components:n})):r.createElement(f,i({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=p;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var l=2;l<a;l++)i[l]=n[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},7229:function(e,t,n){n.r(t),n.d(t,{assets:function(){return d},contentTitle:function(){return c},default:function(){return m},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return u}});var r=n(3117),o=n(102),a=(n(7294),n(3905)),i=["components"],s={sidebar_position:2},c="Containerd",l={unversionedId:"getting-started/basics/containerd",id:"getting-started/basics/containerd",title:"Containerd",description:"Install ContainerD.",source:"@site/docs/getting-started/basics/containerd.md",sourceDirName:"getting-started/basics",slug:"/getting-started/basics/containerd",permalink:"/docs/getting-started/basics/containerd",editUrl:"https://github.com/weaveworks/flintlock/edit/main/userdocs/docs/getting-started/basics/containerd.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"gettingStartedSidebar",previous:{title:"Configure network",permalink:"/docs/getting-started/basics/configuring-network"},next:{title:"Set up Firecracker",permalink:"/docs/getting-started/basics/set-up-firecracker"}},d={},u=[{value:"Create thinpool",id:"create-thinpool",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Start containerd",id:"start-containerd",level:2}],p={toc:u};function m(e){var t=e.components,n=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"containerd"},"Containerd"),(0,a.kt)("p",null,(0,a.kt)("a",{parentName:"p",href:"https://github.com/containerd/containerd/releases"},"Install ContainerD"),"."),(0,a.kt)("p",null,(0,a.kt)("em",{parentName:"p"},"RunC is not required; Flintlock uses various containerd services only.")),(0,a.kt)("h2",{id:"create-thinpool"},"Create thinpool"),(0,a.kt)("p",null,"Flintlock relies on containerd's devicemapper snapshotter to provide filesystem\ndevices for Firecracker microvms. Some configuration is required."),(0,a.kt)("p",null,"The easy quick-start option is to run the ",(0,a.kt)("inlineCode",{parentName:"p"},"hack/scripts/devpool.sh")," script as root.\nI know, it's not recommended in general, and I'm happy you think it's not a good\nway to do things, read the comments in the script for details."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt update\nsudo apt install -y dmsetup bc\n\nsudo ./hack/scripts/devpool.sh\n")),(0,a.kt)("p",null,"Verify with ",(0,a.kt)("inlineCode",{parentName:"p"},"sudo dmsetup ls"),"."),(0,a.kt)("h2",{id:"configuration"},"Configuration"),(0,a.kt)("p",null,"Save this config to ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/containerd/config-dev.toml"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-toml"},'version = 2\n\nroot = "/var/lib/containerd-dev"\nstate = "/run/containerd-dev"\n\n[grpc]\n  address = "/run/containerd-dev/containerd.sock"\n\n[metrics]\n  address = "127.0.0.1:1338"\n\n[plugins]\n  [plugins."io.containerd.snapshotter.v1.devmapper"]\n    pool_name = "dev-thinpool"\n    root_path = "/var/lib/containerd-dev/snapshotter/devmapper"\n    base_image_size = "10GB"\n    discard_blocks = true\n\n[debug]\n  level = "trace"\n')),(0,a.kt)("h2",{id:"start-containerd"},"Start containerd"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# Just to make sure all the directories are there.\nsudo mkdir -p /var/lib/containerd-dev/snapshotter/devmapper\nsudo mkdir -p /run/containerd-dev/\n\nsudo containerd --config /etc/containerd/config-dev.toml\n")),(0,a.kt)("p",null,"containerd will log about 100 lines at boot, most will be about loading plugins, and we recommended\nscrolling up to ensure that the devmapper plugin loaded successfully."),(0,a.kt)("p",null,"Towards the end you should see ",(0,a.kt)("inlineCode",{parentName:"p"},"containerd successfully booted in 0.055357s"),"."),(0,a.kt)("p",null,"To reach our new dev containerd, we have to specify the ",(0,a.kt)("inlineCode",{parentName:"p"},"--address")," flag,\nfor example:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ctr \\\n    --address=/run/containerd-dev/containerd.sock \\\n    --namespace=flintlock \\\n    content ls\n")),(0,a.kt)("p",null,"To make it easier, here is an alias:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},'alias ctr-dev="sudo ctr --address=/run/containerd-dev/containerd.sock"\n')))}m.isMDXComponent=!0}}]);